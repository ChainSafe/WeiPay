__d(function (global, _require, module, exports, _dependencyMap) {
    (function (global, undefined) {
        "use strict";

        if (global.setImmediate) {
            return;
        }

        var nextHandle = 1;
        var tasksByHandle = {};
        var currentlyRunningATask = false;
        var doc = global.document;
        var setImmediate;

        function addFromSetImmediateArguments(args) {
            tasksByHandle[nextHandle] = partiallyApplied.apply(undefined, args);
            return nextHandle++;
        }

        function partiallyApplied(handler) {
            var args = [].slice.call(arguments, 1);
            return function () {
                if (typeof handler === "function") {
                    handler.apply(undefined, args);
                } else {
                    new Function("" + handler)();
                }
            };
        }

        function runIfPresent(handle) {
            if (currentlyRunningATask) {
                setTimeout(partiallyApplied(runIfPresent, handle), 0);
            } else {
                var task = tasksByHandle[handle];

                if (task) {
                    currentlyRunningATask = true;

                    try {
                        task();
                    } finally {
                        clearImmediate(handle);
                        currentlyRunningATask = false;
                    }
                }
            }
        }

        function clearImmediate(handle) {
            delete tasksByHandle[handle];
        }

        function installNextTickImplementation() {
            setImmediate = function setImmediate() {
                var handle = addFromSetImmediateArguments(arguments);
                process.nextTick(partiallyApplied(runIfPresent, handle));
                return handle;
            };
        }

        function canUsePostMessage() {
            if (global.postMessage && !global.importScripts) {
                var postMessageIsAsynchronous = true;
                var oldOnMessage = global.onmessage;

                global.onmessage = function () {
                    postMessageIsAsynchronous = false;
                };

                global.postMessage("", "*");
                global.onmessage = oldOnMessage;
                return postMessageIsAsynchronous;
            }
        }

        function installPostMessageImplementation() {
            var messagePrefix = "setImmediate$" + Math.random() + "$";

            var onGlobalMessage = function onGlobalMessage(event) {
                if (event.source === global && typeof event.data === "string" && event.data.indexOf(messagePrefix) === 0) {
                    runIfPresent(+event.data.slice(messagePrefix.length));
                }
            };

            if (global.addEventListener) {
                global.addEventListener("message", onGlobalMessage, false);
            } else {
                global.attachEvent("onmessage", onGlobalMessage);
            }

            setImmediate = function setImmediate() {
                var handle = addFromSetImmediateArguments(arguments);
                global.postMessage(messagePrefix + handle, "*");
                return handle;
            };
        }

        function installMessageChannelImplementation() {
            var channel = new MessageChannel();

            channel.port1.onmessage = function (event) {
                var handle = event.data;
                runIfPresent(handle);
            };

            setImmediate = function setImmediate() {
                var handle = addFromSetImmediateArguments(arguments);
                channel.port2.postMessage(handle);
                return handle;
            };
        }

        function installReadyStateChangeImplementation() {
            var html = doc.documentElement;

            setImmediate = function setImmediate() {
                var handle = addFromSetImmediateArguments(arguments);
                var script = doc.createElement("script");

                script.onreadystatechange = function () {
                    runIfPresent(handle);
                    script.onreadystatechange = null;
                    html.removeChild(script);
                    script = null;
                };

                html.appendChild(script);
                return handle;
            };
        }

        function installSetTimeoutImplementation() {
            setImmediate = function setImmediate() {
                var handle = addFromSetImmediateArguments(arguments);
                setTimeout(partiallyApplied(runIfPresent, handle), 0);
                return handle;
            };
        }

        var attachTo = Object.getPrototypeOf && Object.getPrototypeOf(global);
        attachTo = attachTo && attachTo.setTimeout ? attachTo : global;

        if ({}.toString.call(global.process) === "[object process]") {
            installNextTickImplementation();
        } else if (canUsePostMessage()) {
            installPostMessageImplementation();
        } else if (global.MessageChannel) {
            installMessageChannelImplementation();
        } else if (doc && "onreadystatechange" in doc.createElement("script")) {
            installReadyStateChangeImplementation();
        } else {
            installSetTimeoutImplementation();
        }

        attachTo.setImmediate = setImmediate;
        attachTo.clearImmediate = clearImmediate;
    })(typeof self === "undefined" ? typeof global === "undefined" ? this : global : self);
});